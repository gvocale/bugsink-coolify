# Bugsink on Coolify with Hetzner & Brevo

This guide documents the specific configurations required to run Bugsink on Coolify (hosted on Hetzner) with Brevo for email delivery.

## 1. Email Configuration (Brevo SMTP)

Hetzner Cloud often blocks standard SMTP ports (25, 465, 587) for new accounts to prevent spam.

**Solution:** Use Port 2525 with TLS.

**`docker-compose.yml` settings:**

```yaml
environment:
  EMAIL_HOST: "smtp-relay.brevo.com"
  EMAIL_PORT: "2525"
  EMAIL_USE_TLS: "True"
  EMAIL_USE_SSL: "False"
  EMAIL_HOST_USER: ${BREVO_SMTP_USER}
  EMAIL_HOST_PASSWORD: ${BREVO_SMTP_KEY}
```

**Required Environment Variables (in Coolify):**

- `BREVO_SMTP_USER`: Your Brevo SMTP login (e.g., `... @smtp-brevo.com`)
- `BREVO_SMTP_KEY`: Your Brevo SMTP API Key.

## 2. Proxy Configuration (Traefik on Coolify)

**Issue:** automatic routing generated by Coolify may fail with `middleware "redirect-to-https@docker" does not exist`, causing a "No available server" error.

**Solution:** Define a custom Traefik router in `labels` to strictly define HTTPS routing and bypass the broken middleware.

**`docker-compose.yml` labels:**

```yaml
labels:
  - "traefik.enable=true"
  - "traefik.http.routers.bugsink-custom.rule=Host(`bugsink.giovanni.is`)" # Replace with your domain
  - "traefik.http.routers.bugsink-custom.entryPoints=https"
  - "traefik.http.routers.bugsink-custom.tls=true"
  - "traefik.http.routers.bugsink-custom.tls.certresolver=letsencrypt"
  - "traefik.http.routers.bugsink-custom.service=bugsink-custom-svc"
  - "traefik.http.services.bugsink-custom-svc.loadbalancer.server.port=8000"
```

## 3. Host Validation (ALLOWED_HOSTS)

**Issue:**

1. `400 Server Error` (DisallowedHost) when accessing the site.
2. Container marked "Unhealthy" because internal health checks (using `localhost`) are rejected.

**Solution:** Explicitly set `BASE_URL` and add BOTH the public domain and `localhost` to `ALLOWED_HOSTS`.

**`docker-compose.yml` settings:**

```yaml
environment:
  BASE_URL: "https://bugsink.giovanni.is"
  ALLOWED_HOSTS: "bugsink.giovanni.is,localhost"
```

_Note: `localhost` is required for the Docker `healthcheck` to pass._
